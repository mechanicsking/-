# Using colcon to build packages
* 목표: colcon을 이용하여 ros2 workspace를 만든다.

다음은 colcon을 사용하여 ROS 2 워크스페이스를 생성하고 구축하는 방법에 대한 간단한 튜토리얼이다. 이 튜토리얼은 실용적이며 핵심 문서를 대체하도록 설계되지 않았다.
## Background
colcon은 ros2에서 제공되는 공식 빌드 도구로 기존의 catkin_make, catkin_make_isolated, catkin_tools 과 ament_tools 등 여러 빌드 도구의 발전형이다. colcon의 디자인에 대한 정보를 알고 싶다면 https://design.ros2.org/articles/build_tool.html 의 문서를 확인하라. 소스코드는 https://github.com/colcon에서 확인할 수 있다.       
package란?- 노드, 라이브러리, 런치 파일 및 다른 여러 정보,파일 등을 하나로 묶는 구조     
## Prerequisites
### Install colcon
```
$sudo apt install python3-colcon-common-extensions
```
해당명령어를 통해 colcon을 다운받는다. 만약 오류가 뜬다면 pip으로 colcon을 설치한다.   
```
$pip3 install -U colcon-common-extensions
```
## Basics
ROS workspace는 특정 구조를 가지는 디렉토리이다. 일반적으로 src 하위디렉토리가 있다. 해당 하위디렉토리 안에는 ROS 패키지의 소스코드가 위치하게 된다. 일반적으로 디렉토리는 비어 있는 상태로 시작한다.  colcon은 out-of-source 빌드(소스코드 밖에서의 빌드)를 수행한다. 기본적으로 colcon은 src 디렉터리와 같은 위치에 다음과 같은 디렉터리들을 생성한다.       
* build 디렉터리는 빌드 과정에서 생성되는 중간 파일(임시파일)이 저장되는 곳이다. 각 패키지별로 하위 폴더가 만들어지고, CMake와 같은 빌드가 이 안에서 이루어진다.
* install 디렉터리는 빌드가 끝나고 나면, 각 패키지가 실제로 설치되는 공간이다. 기본적으로 패키지마다 별도의 설치 하위 폴더가 생긴다.
* log 디렉터리는 colcon 명령을 실행할 때의 다양한 log(실행기록, 에러정보 등)가 저장되는 폴더이다.

주의!- catkin(이전 ros빌드 툴)과 비교했을 때, colcon에는 별도의 devel 디렉터리가 없다. (이전 ROS에서 빌드 중간 결과와 런타임 환경 파일이 보관되는 공간이었으나, colcon에서는 install 방식으로 대체되어 더 효율적인 구조를 가진다.)
<img width="1536" height="1024" alt="generated-image" src="https://github.com/user-attachments/assets/ed282d93-feb1-4c62-ab5b-c85476d65e00" />

### Create a workspace
linux에서 코드가 작성되었다.      
먼저 workspace가 포함된 디렉토리인 ros2_ws를 만들어 준다.   

```
$mkdir -p ~/ros2_ws/src
$cd ~/ros2_ws
```
여기서 mkdir은 드라이브를 만드는 명령어이다. -p옵션은 중첩된 폴더 구조를 한 번에 만들고 싶을 때 쓰는 편리한 옵션이며 이 옵션이 없으면 상위 폴더가 없어서 오류가 난다. 이 시점에서 워크스페이스는 하나의 빈 디렉토리 src만 포함하고 있다.    
```
.
└── src

1 directory, 0 files
```
### Add some sources
src 디렉토리에 소스코드를 추가하기 위해 ROS 2 examples 공식 레포(https://github.com/ros2/examples)를 받아 줄것이다. 이는 다음의 명령어를 이용한다.    
```
$git clone https://github.com/ros2/examples src/examples -b humble
```
이제 워크스페이스는 ros2 examples의 소스코드를 갖고 있다.         
```
.
└── src
    └── examples
        ├── CONTRIBUTING.md
        ├── LICENSE
        ├── rclcpp
        ├── rclpy
        └── README.md

4 directories, 3 files
```

<img width="651" height="155" alt="image" src="https://github.com/user-attachments/assets/72535fb8-c1de-4518-ba70-ce5d685c60ad" />     

### Source an underlay
이미 설치된 ros2 환경의 설정을 source(적용)하는 것이 매우 중요하다. 이 기존 ros2 설치 환경은, 예제 패키지들의 빌드에 필요한 의존성들을 제공한다. 이 작업은 보통 바이너리 설치나 소스 설치(또는 다른 colcon 워크스페이스)가 제공하는 setup 스크립트를 source하는 방식으로 이루어진다. 우리는 이러한 기존 환경을 underlay(언더레이)라고 부른다.     
그리고 우리가 만든 워크스페이스인 ros2_ws는 기존의 ros2 설치 위에 덧붙여지는 overlay(오버레이)역할을 한다. 일반적으로, 많은 패키지를 한 워크스페이스에 모두 넣기보다는, 소수의 패키지를 집중적으로 개발/수정할 때는 오버레이 워크스페이스를 사용하는 것이 권장된다. 즉, 기존 ROS 2 설치(underlay)가 제공하는 환경 위에 내가 작업하는 워크스페이스(overlay)를 올려서 빌드와 실행을 한다는 의미이다.    
