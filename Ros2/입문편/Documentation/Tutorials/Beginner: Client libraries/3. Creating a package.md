# Creating a package
* 목표: CMake 또는 Python을 사용하여 새로운 패키지를 만들고 만든 패키지의 executable(실행파일)을 실행한다. 

## Background
### 1. What is a ROS 2 package?
패키지는 당신의 ros2 코드에서 조직 단위이다. 만약 당신의 코드를 install하거나 다른사람에게 공유하고 싶을때, 패키지에서 organized할 필요가 있다. 패키지를 사용하면, ros2 work를 배포할 수 있고 다른사람이 build하거나 사용하기 쉽게해준다. ros2에서 패키지를 만들때 ament 빌드 시스템과 colcon 빌드 도구를 사용한다. 패키지는 공식적으로 지원되는 CMake나 Python 방식으로 만들 수 있다. 다른 빌드 타입도 있지만 주로 이 두가지를 사용한다.     
### 2. What makes up a ROS 2 package?
ROS 2 파이썬과 CMake 패키지는 각각 자체적으로 필요한 최소 콘텐츠를 갖고 있다.    
```
CMake로 만드는 경우
- CMakeLists.txt 파일이 필요하다. 이 파일은 패키지내 코드를 어떻게 빌드할 것인지에 대한 설명을 담고 있다. 
- include/<package_name> 경로를 갖는다. 이 경로에는 패키지를 위한 public header파일들이 있다. 
- pakcage.xml 파일이 필요하다. 이 파일은 package와 관련된 meta 정보를 갖는데 이는 필요한 의존성을 갖는 패키지이름등을 포함한다. 
- src경로를 갖는다. 이 경로에는 package의 source code가 담겨있다. 
```
```
Python로 만드는 경우
- pakcage.xml 파일이 필요하다. 이 파일은 package와 관련된 meta 정보를 갖는데 이는 필요한 의존성을 갖는 패키지이름등을 포함한다.  
- resource/<package_name> 마커 파일을 갖는다. 
- setup.cfg 가 필요한데 ros2 run 명령어가 패키지의 executable를 찾는데 도움을 준다. 
- setup.py 가 필요하다. 이 python파일은 pakcage를 어떻게 설치할 것인지에 대한 설치 방법이 포함되어 있다. 
- <package_name> 패키지와 같은 이름을 갖는 폴더이다. ROS2 tool을 이용하여 package를 찾는데 사용된다. __init__.py를 포함하고 있다. 
```
가장 간단한 파일구조는 각각 다음과 같다.    
* CMake의 경우
  ```
  my_package/
       CMakeLists.txt
       include/my_package/
       package.xml
       src/
  ```
* Python의 경우
    ```
    my_package/
        package.xml
        resource/my_package
        setup.cfg
        setup.py
        my_package/
    ```

### 3. Packages in a workspace
하나의 워크스페이스에는 사용자가 원하는만큼  많은 패키지를 넣을 수 있다. 이때 각 패키지는 별도의 폴더에 위치한다. 또한 하나의 워크스페이스에 서로 다른 빌드 타입의 패키지를 가질 수 있다. (CMake, Python,등) 패키지 폴더 안에 또 다른 패키지를 넣는 구조 (중첩)은 불가능하며,  , 각 패키지는 src에서 독립적으로 존재해야 한다. src 폴더 아래에만 패키지를 만들면 빌드 시스템에서 패키지 탐색이 용이하고 관리가 쉬우며, 최상위(workspace 폴더)가 정돈된다. 아래 예시처럼 되는 것이 이상적인 ROS2 워크스페이스 구조이다:
```
workspace_folder/
    src/
      cpp_package_1/
          CMakeLists.txt
          include/cpp_package_1/
          package.xml
          src/

      py_package_1/
          package.xml
          resource/py_package_1
          setup.cfg
          setup.py
          py_package_1/
      ...
      cpp_package_n/
          CMakeLists.txt
          include/cpp_package_n/
          package.xml
          src/
```
## Tasks
### 1. Create a package
먼저 ROS2의 기본 workspace를 소스한다.  
```
source /opt/ros/humble/setup.bash
```
새로운 패키지를 만들기 위해 저번시간에 만든 ros2_ws/src로 이동한다. 패키지 생성 명령을 실행하기 전에 src 폴더에 있는지 확인해야한다. 
```
cd ~/ros2_ws/src
```
ros2에서 새로운 패키지를 만들기 위해서 다음의 커멘드 문법을 사용한다.       
* CMake의 경우
  ```
  $ros2 pkg create --build-type ament_cmake --license Apache-2.0 <package_name>
  ```
  이 튜토리얼에서는 옵션인 --node-name을 사용한다. 이는 Hello World 실행 파일(노드)도 같이 만들어 준다.
  ```
  $ros2 pkg create --build-type ament_cmake --license Apache-2.0 --node-name my_node my_package
  ```
  해당 문법에서의 옵션의 의미는 다음과 같다.       
  --build-type ament_cmake: CMake(주로 C++) 빌드 타입을 사용, --license Apache-2.0: 라이선스 지정, --node-name my_node: Hello World 실행 파일(노드)도 같이 만들어 줌, _package: 생성할 패키지 이름.
* Python의 경우
  ```
  $ros2 pkg create --build-type ament_python --license Apache-2.0 <package_name>
  ```
  ```
  $ros2 pkg create --build-type ament_python --license Apache-2.0 --node-name my_node my_package
  ```

작업공간의 src폴더에 들어가면 my_package라는 폴더가 생성된것을 볼 수 있다. 패키지를 생성하는 명령어를 입력했을 때 다음과 같은 메세지가 터미널에 출력될 것이다.     
* CMake의 경우
  ```
  going to create a new package
  package name: my_package
  destination directory: /home/user/ros2_ws/src
  package format: 3
  version: 0.0.0
  description: TODO: Package description
  maintainer: ['<name> <email>']
  licenses: ['TODO: License declaration']
  build type: ament_cmake
  dependencies: []
  node_name: my_node
  creating folder ./my_package
  creating ./my_package/package.xml
  creating source and include folder
  creating folder ./my_package/src
  creating folder ./my_package/include/my_package
  creating ./my_package/CMakeLists.txt
  creating ./my_package/src/my_node.cpp
  ```
