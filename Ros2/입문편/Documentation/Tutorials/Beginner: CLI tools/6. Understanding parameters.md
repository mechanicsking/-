# Understanding parameters
* 목표: 어떻게 ros2에서 parameter들을 얻고, 설정하고, 저장하고, 다시 로드하는 방법을 배운다.

## Background
파라미터는 노드의 설정값이다. 파라미터를 노드의 설정이라고 생각하면 된다. 노드는 파라미터를 integers, floats, booleans, strings, lists의 형태로 저장할 수 있다. ros2에서는 각 노드가 자기 자신의 파라미터를 따로 관리한다.      
## Tasks
### 1. Setup
/turtlesim과 /teleop_turtle 노드를 실행하자.    
### 2. ros2 param list
노드에서 파라미터를 보고 싶다면, 새로운 터미널을 열어 다음의 커멘드를 작성한다.    
```
$ros2 param list
/teleop_turtle:
  qos_overrides./parameter_events.publisher.depth
  qos_overrides./parameter_events.publisher.durability
  qos_overrides./parameter_events.publisher.history
  qos_overrides./parameter_events.publisher.reliability
  scale_angular
  scale_linear
  use_sim_time
/turtlesim:
  background_b
  background_g
  background_r
  qos_overrides./parameter_events.publisher.depth
  qos_overrides./parameter_events.publisher.durability
  qos_overrides./parameter_events.publisher.history
  qos_overrides./parameter_events.publisher.reliability
  use_sim_time
```
실행하면 위와 같은 파라미터들이 나오게 된다. 모든 노드는 use_sim_time이라는 파라미터를 사용한다;turtlesim에만 있는 파라미터가 아니다!     
이 파라미터들의 이름에 기반한다면, /turtlesim의 파라미터들은 turtlesim 윈도우의 배경색에 사용된 RGB 색의 값을 고려한 것처렴 보인다. 파라미터의 타입을 보고싶다면 ros2 param get명령어를 사용하면 된다.     
### 3. ros2 param get
파라미터의 타입과 현재값을 보고싶다면 다음의 커멘드를 사용하면 된다.    
```
$ros2 param get <node_name> <parameter_name>
```
먼저 /turtlesim 노드의 background_g 의 현재값을 찾기 위해선
```
$ros2 param get /turtlesim background_g
Integer value is: 86
```
위의 정보를 통해 background_g는 integer값을 갖는다는 것을 알 수 있다. background_r과 background_b의 파라미터를 찾아보면, 69와 255의 값을 갖을 것이다.    
### 4. ros2 param set
런타임동안 파라미터의 값을 바꾸고 싶다면 다음의 커멘드를 이용한다.     
```
$ros2 param set <node_name> <parameter_name> <value>
```
/turtlesim의 배경 색을 바꾸어보자!
```
$ros2 param set /turtlesim background_r 150
Set parameter successful
```
turtlesim 윈도우의 배경색은 다음과 같이 바뀌게 된다.    
<img width="504" height="535" alt="image" src="https://github.com/user-attachments/assets/b7474c20-4c1f-4935-a885-9ff402d5fcbc" />      
set커멘드를 통한 파라메터 설정은 현제 세션에서만 변경되고, 영구적으로는 변경되지 않는다. 하지만 당신의 새팅을 저장하고 다음에 노드를 실행 할 때 다시 실행되게 할 수 있다.     
### 5. ros2 param dump
다음 커멘드를 통해 노드의 모든 현재 파라미터 값을 볼수 있다.   
```
$ros2 param dump <node_name>
```
<img width="504" height="300" alt="image" src="https://github.com/user-attachments/assets/43a76e55-f501-4091-a14d-1c50c1333608" />     

/turtlesim노드의 파라미터를 살펴보면, 150값이 background_r 파라미터에 저장된 것을 확인해 볼 수 있다.   
해당 명령어는 기본적으로 표준 출력(stdout), 즉 터미널 화면에 바로 결과를 출력한다. 하지만 이 출력 결과(파라미터 값)을 파일로 리다이렉션(저장) 해서 나중에 다시 사용할 수 있다. /turtlesim 노드의 현재 파라미터 설정값들을 turtlesim.yaml 이라는 파일에 저장하려면, 다음의 명령어를 입력하면 된다.
```
$ros2 param dump /turtlesim > turtlesim.yaml
```
지금 사용중인 터미널의 현재 작업 디렉토리에 새로운 파일에 생성되엇을 것이다. 이 파일을 열어보면 아래와 같은 내용이 들어있다.       
<img width="472" height="287" alt="image" src="https://github.com/user-attachments/assets/cf68b456-2332-4710-9084-55116f48c6fd" />       

이렇게 파라미터를 덤프(저장)해 두면, 나중에 동일한 파라미터로 노드를 불러올 때 유용하다.    
### 6. ros2 param load
현재 작동중인 노드에 파일로 부터 파라미터를 불러오려면 다음의 커멘드를 사용한다.   
```
$ros2 param load <node_name> <parameter_file>
```
/turtlesim 노드의 파라미터에 있는 ros2 param dump로 생성된 turtlesim.yaml 파일을 불러오기 위해선 다음의 커멘드를 입력한다.   
```
$ros2 param load /turtlesim turtlesim.yaml
Set parameter background_b successful
Set parameter background_g successful
Set parameter background_r successful
Set parameter qos_overrides./parameter_events.publisher.depth failed: parameter 'qos_overrides./parameter_events.publisher.depth' cannot be set because it is read-only
Set parameter qos_overrides./parameter_events.publisher.durability failed: parameter 'qos_overrides./parameter_events.publisher.durability' cannot be set because it is read-only
Set parameter qos_overrides./parameter_events.publisher.history failed: parameter 'qos_overrides./parameter_events.publisher.history' cannot be set because it is read-only
Set parameter qos_overrides./parameter_events.publisher.reliability failed: parameter 'qos_overrides./parameter_events.publisher.reliability' cannot be set because it is read-only
Set parameter use_sim_time successful
```
주의!!-읽기 전용 파라미터는 오직 노드가 시작될 때 변경할 수 있고, 실행중에는 변경할 수 없다. 그렇기 때문에 qos_overrides같은 파라미터를 런타임중에 바꾸려하면 경고가 뜨게 된다.      
### 7. Load parameter file on node startup
저장된 파라미터 값과 같은 노드를 실행하기 위해선 다음의 커멘드를 사용한다.    
```
$ros2 run <package_name> <executable_name> --ros-args --params-file <file_name>
```
이거은 turtlesism노드를 실행할 때 평소에 사용하는 명령에 옵션 --ros-args와 --params-file 플래그(인자)가 추가 된것이다. 그리고 그다음에 불러오고자 하는 파라미터 설정 파일 이름을 명시한다.    
실행중인 turtlesim 노드를 멈추고 저장된 파라미터를 리로딩하는 커멘드는 다음과 같다.   
```
$ros2 run turtlesim turtlesim_node --ros-args --params-file turtlesim.yaml
```
<img width="860" height="530" alt="image" src="https://github.com/user-attachments/assets/bf4ff9ec-c974-469a-bc35-1b7362e7e3b7" />     

다음과 같이 잘 작동되는 것을 확인 할 수 있다.      
주의!!-노드가 시작할 때 그 노드에 적용되는 모든 파라미터가 설정파일에 기록된 값으로 최신화 된다. 여기에는 일반적으로 runtime에는 변경할 수 없는 read-only 파라미터도 포함된다.    
## Summary
노드는 기본 구성값을 정의할 수 이쓴 파라미터가 있다. 명령줄을 통해 파라미터 값을 get과 set 할 수 있다. 또한 파라미터 설정 파일을 저장하고 다음에 reload할 수 있다. 
