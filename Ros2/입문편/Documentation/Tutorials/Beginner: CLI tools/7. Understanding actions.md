# Understanading actions
* 목표: ros2에서 action을 알아본다.

## Background
action은 ros2에서 의사소통 타입중 하나이고 장기적인 작업을 위해 설계되었다. action은 goal, feedback, result 3가지의 파트로 이루어져있다. 액션은 토픽과 서비스로 이루어져있다. 이것의 기능은 서비스와 유사하지만 액션은 취소할 수 있다. 이것은 단일 응답을 반환하는 서비스와는 대조적으로 일정한 피드백을 제공한다.       
액션은 publisher-subscriber모델과 비슷한 client-server 모델을 사용한다. action client노드는 action server노드에게 목표를 보낸다. 서버는 목표를 받고 승인하며, 작업 진행 상황(feedback)을 계속 알려주고, 마지막에 최종 결과(recult)도 전달한다.     
<img width="854" height="480" alt="image" src="https://github.com/user-attachments/assets/bdf1fdbb-f937-48d2-a2db-4d0ad9ff17d6" />     
## Tasks
### 1. Setup
/turtlesim과 /teleop_turtle 노드를 실행하자.    
### 2. Use actions
/teleop_turtle 노드를 실행하면, 다음과 같은 메시지를 터미널에서 확인할 수 있다.    
```
Use arrow keys to move the turtle.
Use G|B|V|C|D|E|R|T keys to rotate to absolute orientations. 'F' to cancel a rotation.
```
action에 해당하는 두번째 줄을 보자(첫번째 지침은 이전의 토픽 튜토리얼에서 논의된 "cmd_vel"주제에 해당한다.)       
G|B|V|C|D|E|R|T 문자열은 키보드에서 F 키를 둘러싼 박스 모양이라는 것을 알 수 있다. F주변의 각키는 turtlesim의 해당 방향에 해당한다. 예를 들어 E 키는 turtle의 방향을 왼쪽 위코너를 향하게 한다.        
/turtlesim 노드가 작동중인 터미널을 집중하라. 이 키들을 누르는 각각의 시간에 /turtlesim 노드의 action server에 목표를 보내고 있다. 목표는 turtle의 얼굴이 특별한 방향으로 회전하는 것이다. 거북이가 회전을 완료하면 목표 결과를 전달하는 메시지가 다음과 같이 표현되어야한다. 

```
[INFO] [turtlesim]: Rotation goal completed successfully
```    
F키는 실행 중에 목표를 취소한다. C를 누르고 turtle이 회전을 완료하기 전에 F키를 눌러보면 /turtlesim 노드가 작동중인 터미널에서는 다음의 메시지를 볼 수 있다.    
```
[INFO] [turtlesim]: Rotation goal canceled
```
client-side(teleop에 입력한 값)에서 목표를 멈출수 있고, server-side(/turtlesim 노드)에서도 목표를 멈출 수 있다. server-side에서 목표를 멈추는 것을 'abort'(중단)한다고 한다.      
D키를 누르고 이 첫번째 회전이 완료되기 전에 G키를 누르면 /turtlesim노드가 작동되는 터미널에서 다음의 메시지를 볼 수 있다.    
```
[WARN] [turtlesim]: Rotation goal received before a previous goal finished. Aborting previous goal
```
이 액션 서버는 첫번째 목표를 abort하기를 선택했다. 그 이유는 새로운 목표를 얻었기 때문이다. 새로운 목표를 거부하거나 첫번째 목표가 끝난 후 두 번째 목표를 실행하는 등 다른 방법도 있다. 그렇기에 모든 액션 서버가 새로운 목표를 얻었을 대 현재 목표를 중단하기로 선택한다고 가정하면 안된다.     
### ros2 node info 
노드가 제공하는 action의 리스트를 확인해보자. /turtlesim의 경우, 새로운 터미널을 열어 다음의 커멘드를 실행해보자.    
```
$ros2 node info /turtlesim
/turtlesim
  Subscribers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /turtle1/cmd_vel: geometry_msgs/msg/Twist
  Publishers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /rosout: rcl_interfaces/msg/Log
    /turtle1/color_sensor: turtlesim/msg/Color
    /turtle1/pose: turtlesim/msg/Pose
  Service Servers:
    /clear: std_srvs/srv/Empty
    /kill: turtlesim/srv/Kill
    /reset: std_srvs/srv/Empty
    /spawn: turtlesim/srv/Spawn
    /turtle1/set_pen: turtlesim/srv/SetPen
    /turtle1/teleport_absolute: turtlesim/srv/TeleportAbsolute
    /turtle1/teleport_relative: turtlesim/srv/TeleportRelative
    /turtlesim/describe_parameters: rcl_interfaces/srv/DescribeParameters
    /turtlesim/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
    /turtlesim/get_parameters: rcl_interfaces/srv/GetParameters
    /turtlesim/list_parameters: rcl_interfaces/srv/ListParameters
    /turtlesim/set_parameters: rcl_interfaces/srv/SetParameters
    /turtlesim/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
  Service Clients:

  Action Servers:
    /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
  Action Clients:
```
이 커멘드는 /turtlesim의 subscriber, publisher, service, action server, action client의 리스트를 반환한다.     
/turtlesim의 /turtle1/rotate_absolute 액션은 Action servers아래에 있다. 이 뜻은 /turtlesim이 /turtle1/rotate_absolute 엑션에 반응하고 피드백을 제공한다는 것을 의미한다. /teleop_turtle 노드는 Action Clients에서 /turtle1/rotate_absolute라는 이름을 가지고 있으며, 이는 해당 액션 이름에 대한 목표를 전송한다는 의미이다. 이를 확인하려면 다음을 실행한다.     
```
$ros2 node info /teleop_turtle
/teleop_turtle
  Subscribers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
  Publishers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /rosout: rcl_interfaces/msg/Log
    /turtle1/cmd_vel: geometry_msgs/msg/Twist
  Service Servers:
    /teleop_turtle/describe_parameters: rcl_interfaces/srv/DescribeParameters
    /teleop_turtle/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
    /teleop_turtle/get_parameters: rcl_interfaces/srv/GetParameters
    /teleop_turtle/list_parameters: rcl_interfaces/srv/ListParameters
    /teleop_turtle/set_parameters: rcl_interfaces/srv/SetParameters
    /teleop_turtle/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
  Service Clients:

  Action Servers:

  Action Clients:
    /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
```
### 4. ros2 action list
ros graph에서 모든 action을 확인하고 싶다면 다음의 커멘드를 실행한다.    
```
$ros2 action list
/turtle1/rotate_absolute
```
이것이 현재 ros graph에 있는 유일한 action이다. 이것은 앞에서 보았다시피 turtle의 회전을 조절한다. 
