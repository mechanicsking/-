(25.07.01작성)
# 5강 Symbolics
로봇의 운동방정식을 구하고 계산하는 작업은 매우 복잡한 수식들로 이루어져있다. 이러한 연산들은 수치적인 것이 아니라 미지수와 미분, 적분 등 대수적인 연산으로 이루어져 있다.    
![image](https://github.com/user-attachments/assets/d6ba99a2-6750-4a17-9b3a-1bcf4724143c)   
이렇게 식이 매우 복잡하기에 파이썬의 패키지인 sympy를 사용한다. 수치적인 연산은 numpy를 사용하여 해결하고 대수적인 연산을 위해서는 sympy를 사용한다.   
## Sympy 기초
다음의 코드를 통해 sympy를 익혀보자    
![image](https://github.com/user-attachments/assets/91b95aec-1254-4e45-a3b2-f191b6d891b2)   
```python
import sympy as sy

x = sy.symbols('x', real=True)
f0 = x**2 + 2*x +1
print(f"f0 : {f0}")

df0_fx = sy.diff(f0, x)
print(f"df0_fx : {df0_fx}")

result = df0_fx.subs(x, 1)
print(f"result : {result}")

complex_equ = sy.cos(x)**2 + sy.sin(x)**2
print(f"complex_equ : {complex_equ}")

simple_equ = sy.simplify(complex_equ)
print(f"simple_equ : {simple_equ}")
```
```
> result
f0 : x**2 + 2*x + 1
df0_fx : 2*x + 2
result : 4
complex_equ : sin(x)**2 + cos(x)**2
simple_equ : 1
```
Jacobian, Matrix 등 더 많은 기능들이 있지만, 이번 예시에서는 위 함수들만을 통해 몇가지 예시들을 구현해볼 것이다.   
### 1. Symbolic Differential vs Numerical Differential
첫번째 예제의 목표는 수치적 미분과 대수적 미분을 비교해보는 것이다. 목표 함수로는 $f_0=x^2+2x+1$을 이용한다. 
먼저 sybolic differential이다.
```python
import sympy as sy

x = sy.symbols('x', real=True)
f0 = x ** 2 + 2 * x + 1
print(f"f0 : {f0}")

df0_fx = sy.diff(f0, x)
print(f"df0_fx : {df0_fx}")

result = df0_fx.subs(x, 1)
print(f"result : {result}")
```
```
> result
f0 : x**2 + 2*x + 1
df0_fx : 2*x + 2
result : 4
```
다음은 numerical 을 구현한다. forward difference과 central difference를 이용한다.   
```python
import sympy as sy

# prepare equations
x = sy.symbols('x', real=True)
f0 = x ** 2 + 2 * x + 1
print(f"f0 : {f0}")

x_val = 1
epsilon = 1e-5
F0 = f0.subs(x, x_val - epsilon)
F1 = f0.subs(x, x_val)
F2 = f0.subs(x, x_val + epsilon)

# calculate numerical diff
fwd_diff = (F2 - F1) / epsilon
ctr_diff = (F2 - F0) / (2 * epsilon)
print(f"fwd_diff : {fwd_diff} / ctr_diff : {ctr_diff}")
```
```
> result
f0 : x**2 + 2*x + 1
fwd_diff : 4.00001000002703 / ctr_diff : 4.00000000000400
```
약간의 차이가 있지만 동일한 4라는 값을 얻게된다.
### 2. Chain Rule 구현
합성함수 미분시 chain rule을 사용한다. chain rule을 통한 미분은 상황에 따라 크게 두가지 종류로 분리된다.   
단일변수 함수의 미분--> 함수 전체가 단일 변수로 구성된 함수의 경우, 일반적인 합성함수의 치환 미분과 같이 계산하며, 아래와 같은 정의를 갖는다.   
$\frac{dy}{dx} = \frac{dy}{du} * \frac{du}{dx}$   
다변수 함수의 미분(전미분)-->예를 들어, $x, y$에 대한 식을 미분할 시, 원하는 변수를 제외한 모든 것을 상수로 간주하는 경우는 편미분이라고 한다.  하지만, 단일 변수에 대한 미분값이 아니라, 이것이 다변수로 확장될 시 아래와 같은 전미분 식을 사용한다.   
![image](https://github.com/user-attachments/assets/8126ae7e-8d6c-43e5-a97e-85557371f24b)   
예시)$f_2=x*dot(x)$   
![image](https://github.com/user-attachments/assets/a24c6fdc-0a8e-49be-b142-a50545e2813f)


