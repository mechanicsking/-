(25.07.03 작성)
# 6강 Double pendulum
이번 장에서는 sympy를 통해 단순한 질점이 아닌 로봇팔과 같은 2 DOF를 갖는 double pendulum의 운동방정식을 구현하고 시뮬레이션해볼 것이다.   
이러한 개발을 위해서 절차는 다음과 같다.   
1. 좌표축을 설정하고, 각 좌표축 사이의 Homogeneous Matrix를 계산한다.
2. 운동에너지와 위치에너지, 라그랑지안을 구한다.
3. 이를 통해 Euler-Lagrange equation을 뽑아내서 이것으로 EOM을 얻어낸다.
4. 그 후 시뮬레이션을 진행한다.

## 1.좌표축 설정 및 H 구하기
먼저 좌표계를 통한 kinematics해석을 위해 그림을 작성한다. 다음의 그림과 같이 총 3개의 다른 좌표계가 존재하며 이들 사이 변환 행렬을 구해줘야한다.   
![image](https://github.com/user-attachments/assets/92293fab-1a95-4071-b003-32fd63c97ed1)    
### O0, O1 변환
천장에 매달린 기준으로 좌표계를 잡았기 때문에 joint각도에 270을 더해야 한다.   
![image](https://github.com/user-attachments/assets/c31cfd03-4d6e-4917-b1b5-a31ee2310d31)   
### O1, O2 변환
![image](https://github.com/user-attachments/assets/81584f0e-7891-48fb-afe3-5e2d2c6793b8)   
O0, O2변환은 Homogeneous Matrix의 특성을 이용하여 구해준다.  
![image](https://github.com/user-attachments/assets/2b0f37dc-d4e9-42a8-b935-13ffc6bba1fc)    
여기까지 우리는 일단 FK을 다 구해두었다. 이제 Lagrangian을 구해서 운동방정식을 구해주어야한다.   
## 2.운동에너지, 위치에너지, 라그랑지안 구하기
여기서 주의할 점은 운동에너지와 위치에너지를 구하기 위해선 연결점이 아닌 각 질점의 속도와 y좌표를 구해야 한다. 지금의 좌표를 구하고 직접 미분하여 속도를 계산하였지만, 이후에는 자코비안과 sympy를 사용하여 손쉽게 구할 예정이다.   
![image](https://github.com/user-attachments/assets/ca25cd2a-b977-498b-ac33-c1dcde3d6d80)
밑의 사진은 위치 에너지와 운동에너지를 통해 라그랑지안을 구한 모습이다. 현재 기준 좌표계는 x, y 직교 좌표계가 아닌 각도 좌표계이다. (실제 제어시에도 joint angle, velocity, torque를 제어할 것이기 때문) --> 따라서 모든 위치, 속도, 좌표는 $/theta_1, /theta_2$에 관한 식이 된다.   
![image](https://github.com/user-attachments/assets/d64cf328-55dc-4c34-86c2-3d5707cf1032)    
여기서 주의할 점은 운동에너지에 수평운동에너지+회전운동에너지 모두를 고려해줘야한다.   
## 3.E-L equation, EOM
이제 EL equation을 구해야하는데 이때 5강에서 구현한 sympy함수를 사용할 것이다.  
![image](https://github.com/user-attachments/assets/a7000d61-c0dd-4e05-9246-e765eb44111f)   
이렇게 EOM을 구했다면 전체 수식을 아래와 같이 행렬 형태로 간소화 할 수 있다.    
![image](https://github.com/user-attachments/assets/b7b9c10d-2a6a-4a04-b263-545d20ea606f)   
운동방정식을 작성할 땐 보통, M(theta_dd)+C(theta_d, theta)+G(theta)=sth 이런식으로 작성한다.   

## 4.코드 구현 
이 예시에서의 코드는 크게 두 부분으로 나뉘어진다.    
1. EOM을 계산하는 sympy 코드 - derive_double_pendulum.py   
2. 시뮬레이션을 통한 시각화 코드 - main_double_pendulum.py    

먼저 운동방정식을 도출 하는 코드를 실행하면 운동방정식과 M, C, G 행렬에 대한 모든 element를 출력해준다.   
![image](https://github.com/user-attachments/assets/849a2150-ae1d-415d-8ea3-d79ba01dfbe8)    
derive_double_pendulum.py 코드는 다음과 같다.   




